== A Rule Engine for the Airline Market Simulator ==

=== Abstract ===

Some components of the Airline Market Simulator project ()
Specifications for a rule engine for the simulation-related components
(e.g., Pricing, Yield Calculation/Retrieval and Customer Choice Model)

=== Implementation ===

A hash key is defined as:
  typedef std::string HashKey_T;

The BomKeyManager class gathers key-related utilities:
  class BomKeyManager {
    static HashKey_T makeKey (...);
  };

Each component defines specific rule structures. For instance, the
pricing component (SimFQT) defines FareRuleStruct:
  struct FareRuleStruct {
    //
    HashKey_T describeKey (...) {
      return BomKeyManager::makeKey (...);
    }
    //
    // ////// Attributes /////
    AirlineCodeList_T _airlineCodeList;
    AirportCode_T _origin;
    AirportCode_T _destination;
    // ...
  };

Two template classes are defined in order to implement the two-stage
indexing mechanism.

=== First Stage Indexing ===

  template <RULE_TYPE>
  struct BaseRuleStruct {
    //
    HashKey_T describeKey (...) {
      return BomKeyManager::makeKey (...);
    }
    //
    // ////// Attributes /////
    AirlineCodeList_T _airlineCodeList;
    AirportCode_T _origin;
    AirportCode_T _destination; 
    // ...
  };


=== Second Stage Indexing ===

  template <RULE_TYPE>
  struct ExtraRuleStruct {
    //
    HashKey_T describeKey (...) {
      return BomKeyManager::makeKey (...);
    }
    //
    // ////// Attributes /////
    Period_T _departurePeriod;
    Duration_T _advancePurchase;
    Duration_T _minimumStay;
    // ...
  };


=== BOM Tree ===

The RuleManager is directly attached to the BomRoot instance, and defined as:

  class RuleManager {
    //
    std::multimap<HashKey_T, RuleBucket<FareRuleStruct> > _fareRuleBucket;
    std::multimap<HashKey_T, RuleBucket<YieldRuleStruct> > _yieldRuleBucket;
    std::multimap<HashKey_T, RuleBucket<CCRuleStruct> > _ccRuleBucket;
    //
    BomRoot* _parent;
  };


The RuleBucket structures are defined as:

  template <RULE_TYPE>
  struct RuleBucket {
    //
    HashKey_T _key;
    //
    std::list<ExtraRuleStruct<RULE_TYPE> > _extraRuleList;
  };

